# Ranger Configuration
# For more information: https://ranger.tcbinternal.net/docs/configuration/ranger_yaml

version: 1.3.1

# Enable caching
cache: true

# File storage configuration - Use S3 for all file types
fileStrategy: "s3"

# Custom interface configuration
interface:
  #customWelcome: 'Your AI assistant with web search, code execution, and file analysis capabilities.'
  # Custom branding logo configuration (optional)
  # If not set, uses default branding-logo-dark.svg and branding-logo-lite.svg
  # customLogo:
  #   lightTheme: '/assets/openai.svg'
  #   darkTheme: '/assets/google.svg'
  # Custom theme colors configuration (optional)
  # primary: The main brand color used for buttons, selected states, etc.
  # primaryHover: The hover state color for primary elements
  # Examples:
  #   Purple: primary: 'rgb(147, 51, 234)', primaryHover: 'rgb(126, 34, 206)'
  #   Green: primary: 'rgb(34, 197, 94)', primaryHover: 'rgb(22, 163, 74)'
  #   Orange: primary: 'rgb(249, 115, 22)', primaryHover: 'rgb(234, 88, 12)'
  #   Pink: primary: 'rgb(236, 72, 153)', primaryHover: 'rgb(219, 39, 119)'
  #   Teal: primary: 'rgb(20, 184, 166)', primaryHover: 'rgb(13, 148, 136)'
  # themeColors:
  #   primary: 'rgb(147, 51, 234)'
  #   primaryHover: 'rgb(126, 34, 206)'
  fileSearch: true
  webSearch: true
  runCode: true
  artifacts: true
  # privacyPolicy:
  #   externalUrl: 'https://ranger.tcbinternal.net/privacy-policy'
  #   openNewTab: true
  # termsOfService:
  #   externalUrl: 'https://ranger.tcbinternal.net/tos'
  #   openNewTab: true
  endpointsMenu: true
  modelSelect: true
  parameters: true
  sidePanel: true
  presets: true
  prompts: true
  bookmarks: true
  multiConvo: false
  agents: true
  peoplePicker:
    users: true
    groups: true
    roles: true
  marketplace:
    use: true
  fileCitations: true

# Registration settings
registration:
  socialLogins: ['openid']  # Enable Okta/OpenID login

# Memory Configuration - Personalized User Experience
# Enables persistent memory across conversations for a personalized experience
# The AI can remember user preferences, important facts, and context
memory:
  disabled: false                    # Enable memory feature
  personalize: true                  # Allow users to toggle memory on/off in their settings
  tokenLimit: 4000                   # Maximum tokens for memory storage (controls cost)
  charLimit: 15000                   # Maximum characters per memory entry
  messageWindowSize: 8               # Number of recent messages to analyze for memory updates
  
  # Valid memory categories - restricts what types of information can be stored
  # This provides structure and helps the memory agent organize information
  validKeys:
    - "user_preferences"             # Communication style, topics of interest, workflow preferences
    - "personal_info"                # Name, role, team, location (explicitly shared by user)
    - "project_context"              # Ongoing projects, tasks, deadlines mentioned
    - "technical_preferences"        # Preferred languages, frameworks, tools, coding style
    - "learned_facts"                # Important facts about the user's work or domain
  
  # Memory agent configuration - uses Nova Micro (cheapest model) for memory processing
  agent:
    provider: "bedrock"
    model: "us.amazon.nova-micro-v1:0"
    instructions: |
      You are a memory assistant. Save user preferences, feedback, and instructions.
      
      ## SAVE MEMORIES (set_memory) - Trigger Phrases:
      
      DIRECT REQUESTS:
      - "Remember..." / "Don't forget..." / "Please remember..."
      - "Store this..." / "Save this..." / "Keep in mind..." / "Note that..."
      - "Make a note..." / "Keep track of..."
      
      PREFERENCES:
      - "I prefer..." / "I like..." / "I want..."
      - "I always..." / "I never..."
      - "Going forward..." / "From now on..." / "Next time..."
      - "I'd rather..." / "I'd like you to..."
      
      FEEDBACK & CORRECTIONS (ALWAYS SAVE THESE):
      - "Don't do that again" / "Stop doing..." / "Never do..."
      - "That was wrong" / "That's not right" / "Not like that"
      - "I don't like when you..." / "I hate when..."
      - "Please don't..." / "Please always..."
      - "You should..." / "You shouldn't..."
      - "Too long" / "Too short" / "Too verbose" / "Too brief"
      - "Be more..." / "Be less..."
      - "Do it this way" / "This is how I want it"
      
      PERSONAL INFO:
      - "My name is..." / "I am..." / "I work at..." / "I'm a [role]..."
      
      ## EXAMPLES:
      
      | Input | Key | Value |
      |-------|-----|-------|
      | "remember not to hallucinate" | user_preferences | "Wants factual responses, no hallucination" |
      | "don't make responses so long" | user_preferences | "Prefers shorter responses" |
      | "I prefer TypeScript" | technical_preferences | "Prefers TypeScript" |
      | "never use var" | technical_preferences | "Never use var, use const/let" |
      | "that was too technical" | user_preferences | "Prefers simpler explanations" |
      | "my name is John" | personal_info | "Name: John" |
      
      ## DELETE MEMORIES (delete_memory):
      - "Forget..." / "Delete memory..." / "Remove memory..." / "That's outdated"
      
      ## DO NOT SAVE:
      - Casual conversation
      - Task requests ("generate image", "search for", "write code for")
      
      ## VALID KEYS:
      - user_preferences: Response style, behavior preferences
      - personal_info: Name, role, location
      - project_context: Projects, tasks
      - technical_preferences: Languages, tools, coding style
      - learned_facts: Domain knowledge
      
      RULE: If user expresses ANY preference or feedback about your behavior → SAVE IT.
    model_parameters:
      temperature: 0.1                # Very low temperature for strict rule following
      max_tokens: 1500

# Intent Analyzer Configuration - Model Routing
# Uses @ranger/intent-analyzer package
#
# Tool selection is config-driven via toolsAutoEnabled above.
# MCP tools are added when user selects them in the UI dropdown.
#
# modelRouting (4-Tier Automatic Model Selection):
#   SIMPLE   (~1%)   Nova Micro  $0.035/$0.14   Greetings, text-only simple responses
#   MODERATE (~80%)  Haiku 4.5   $1/$5          Most tasks, tool usage, standard code
#   COMPLEX  (~15%)  Sonnet 4.5  $3/$15         Debugging, detailed analysis
#   EXPERT   (~4%)   Opus 4.5    $15/$75        Deep analysis, architecture, research
#
# Routing Rules:
#   - Tool usage → Haiku 4.5 minimum (Claude handles tools better)
#   - Deep/comprehensive analysis → Opus 4.5
#   - Text-only simple queries → Nova Micro
#
# preset: Controls maximum model tier
#   'premium'       - Up to Opus 4.5
#   'costOptimized' - Up to Sonnet 4.5
#   'ultraCheap'    - Up to Haiku 4.5
#
# Uses regex patterns only - defaults to Haiku 4.5 if no pattern matches
intentAnalyzer:
  modelRouting: true
  preset: 'premium'
  debug: true
  endpoints:
    bedrock:
      enabled: true

# Actions configuration
actions:
  allowedDomains:
    - 'swapi.dev'
    - 'ranger.tcbinternal.net'
    - 'google.com'
    - 'api.github.com'
    - 'wikipedia.org'

# Endpoints configuration
endpoints:
  # Agents configuration
  agents:
    recursionLimit: 50
    maxRecursionLimit: 100
    iconURL: "/assets/default-agent-icon.svg"
    disableBuilder: false
    maxCitations: 30
    maxCitationsPerFile: 7
    # Lower threshold for RAG - cosine distances result in relevance scores around 0.05-0.45
    minRelevanceScore: 0.05
    capabilities: ["execute_code", "file_search", "web_search", "youtube_video", "artifacts", "actions", "tools", "context", "chain"]
    # Tools that are auto-enabled (included by default unless intent classification says not needed)
    toolsAutoEnabled: ["execute_code", "file_search", "artifacts", "youtube_video", "web_search"]

  # AWS Bedrock configuration
  bedrock:
    titleConvo: true
    titleModel: "us.amazon.nova-micro-v1:0"  # Use cheap Nova Lite for title generation
    modelDisplayLabel: "Ranger"
    endpointCustomLabel: "Ranger"  # Used for both UI display and system prompt identity
    endpointCustomDescription: "I am Ranger. Your AI assistant with advanced capabilities including web search, code execution, file analysis, and artifact creation."
    iconURL: "/assets/icon-dark.svg"
    models:
      default:
        # Latest Claude 4.5 and 4 models (inference profiles)
        - "global.anthropic.claude-opus-4-5-20251101-v1:0"
        - "us.anthropic.claude-sonnet-4-5-20250929-v1:0"
        - "us.anthropic.claude-haiku-4-5-20251001-v1:0"
        - "us.anthropic.claude-opus-4-1-20250805-v1:0"
        - "us.anthropic.claude-sonnet-4-20250514-v1:0"
        - "us.anthropic.claude-opus-4-20250514-v1:0"
        # Claude 3.7 and 3.5 models (inference profiles)
        - "us.anthropic.claude-3-7-sonnet-20250219-v1:0"
        - "us.anthropic.claude-3-5-sonnet-20241022-v2:0"
        - "us.anthropic.claude-3-5-sonnet-20240620-v1:0"
        - "us.anthropic.claude-3-5-haiku-20241022-v1:0"
        # Claude 3 models (inference profiles)
        - "us.anthropic.claude-3-haiku-20240307-v1:0"
        - "us.anthropic.claude-3-opus-20240229-v1:0"
        - "us.anthropic.claude-3-sonnet-20240229-v1:0"
        # Meta Llama models (inference profiles for cross-region)
        - "us.meta.llama3-3-70b-instruct-v1:0"
        # Meta Llama models (direct)
        - "meta.llama3-1-405b-instruct-v1:0"
        - "meta.llama3-1-70b-instruct-v1:0"
        - "meta.llama3-1-8b-instruct-v1:0"
        - "meta.llama3-70b-instruct-v1:0"
        - "meta.llama3-8b-instruct-v1:0"
        # Mistral models
        - "mistral.mistral-large-2407-v1:0"
        - "mistral.mistral-large-2402-v1:0"
        - "mistral.mistral-small-2402-v1:0"
        # Amazon Nova models (inference profiles)
        - "us.amazon.nova-premier-v1:0"
        - "us.amazon.nova-pro-v1:0"
        - "us.amazon.nova-lite-v1:0"
        - "us.amazon.nova-micro-v1:0"
        # Amazon Nova 2 models
        - "global.amazon.nova-2-lite-v1:0"
        # Amazon Titan models
        - "amazon.titan-text-premier-v1:0"
        - "amazon.titan-text-express-v1"
        - "amazon.titan-text-lite-v1"
      fetch: false

# Model specifications with user-friendly categories
# modelSpecs:
#   enforce: true
#   prioritize: true
#   # Add the agents endpoint to allow selection alongside modelSpecs
#   addedEndpoints: ["agents"]
#   list:
#     # Instant - Fast responses for quick queries
#     - name: "us.anthropic.claude-haiku-4-5-20251001-v1:0"
#       label: "Instant"
#       description: "Fast and efficient responses for quick queries and simple tasks"
#       default: true
#       endpoint: "bedrock"
#       preset:
#         model: "us.anthropic.claude-haiku-4-5-20251001-v1:0"
#         endpoint: "bedrock"
#         maxContextTokens: 200000

#     # Thinking / Coding - Balanced reasoning and programming
#     - name: "us.anthropic.claude-sonnet-4-5-20250929-v1:0"
#       label: "Thinking / Coding"
#       description: "Advanced reasoning and programming capabilities with balanced performance"
#       default: false
#       endpoint: "bedrock"
#       preset:
#         model: "us.anthropic.claude-sonnet-4-5-20250929-v1:0"
#         endpoint: "bedrock"
#         maxContextTokens: 200000

#     # Research - Deep analysis and complex reasoning
#     - name: "global.anthropic.claude-opus-4-5-20251101-v1:0"
#       label: "Research"
#       description: "Most capable model for deep analysis, complex reasoning, and research tasks"
#       default: false
#       endpoint: "bedrock"
#       preset:
#         model: "global.anthropic.claude-opus-4-5-20251101-v1:0"
#         endpoint: "bedrock"
#         maxContextTokens: 200000

# File configuration
fileConfig:
  endpoints:
    bedrock:
      fileLimit: 10
      fileSizeLimit: 20
      totalSizeLimit: 100
      supportedMimeTypes:
        # Image files
        - "^image/(png|jpeg|jpg|gif|webp|heic|heif|svg\\+xml)$"
        # Document files
        - "^application/pdf$"
        - "^text/(plain|csv|markdown|html|x-tex)$"
        # Microsoft Office documents
        - "^application/vnd\\.openxmlformats-officedocument\\.wordprocessingml\\.document$"  # .docx
        - "^application/vnd\\.openxmlformats-officedocument\\.spreadsheetml\\.sheet$"  # .xlsx
        - "^application/vnd\\.openxmlformats-officedocument\\.presentationml\\.presentation$"  # .pptx
        # Archive files
        - "^application/(zip|x-tar)$"
        # Programming and markup files
        - "^application/(json|xml|typescript)$"
        - "^text/(css|javascript|x-python|x-java|x-c|x-c\\+\\+|x-ruby|x-php|x-sql|x-sh)$"
        # Additional shell and config files  
        - "^application/(x-sh|x-yaml)$"
    default:
      totalSizeLimit: 50
  serverFileSizeLimit: 100
  avatarSizeLimit: 2
  clientImageResize:
    enabled: true
    maxWidth: 1900
    maxHeight: 1900
    quality: 0.92

# Web Search Configuration
webSearch:
  # Search provider (required)
  searchProvider: serper
  serperApiKey: '${SERPER_API_KEY}'
  
  # Content scraper (required)
  scraperProvider: firecrawl
  firecrawlApiKey: '${FIRECRAWL_API_KEY}'
  firecrawlApiUrl: '${FIRECRAWL_API_URL}'
  
  # Reranker - disabled for speed (options: 'jina', 'cohere', 'none')
  # Reranking adds latency but improves result relevance
  rerankerType: 'none'
  # jinaApiKey: '${JINA_API_KEY}'
  
  # Scraper timeout (optional, in ms) - lower for faster responses
  scraperTimeout: 5000
  
  # Safe search (optional: 0=OFF, 1=MODERATE, 2=STRICT)
  safeSearch: 1
  
  # Firecrawl options to reduce tokens and improve quality
  firecrawlOptions:
    # Output formats - markdown is most efficient for LLM processing
    formats: ["markdown"]
    # Performance optimizations
    onlyMainContent: true
    removeBase64Images: true
    blockAds: true
    skipTlsVerification: true
    # Caching - optimized for financial/stock data freshness (15 minutes)
    maxAge: 900000
    # Timeouts and delays - reduced for speed
    waitFor: 0
    timeout: 5000
    # Content filtering for better quality
    excludeTags: ["nav", "footer", "aside", ".ads", ".sidebar", ".menu", ".header-nav", ".social-share"]
    includeTags: ["main", "article", ".content", ".post", ".entry"]
    # Proxy settings for reliability vs speed
    proxy: "basic"
    # Data retention and privacy
    storeInCache: true
    zeroDataRetention: false

# MCP Servers Configuration
# mcpServers: {}
# mcpServers:
  # OPTION 1: OAuth handled by SharePoint-MCP server (commented out)
  # ms365-mcp:
  #   title: "Microsoft 365"
  #   iconPath: "Microsoft365Icon"
  #   type: streamable-http
  #   url: "http://localhost:3001/sharepoint-mcp/mcp"
  #   timeout: 30000
  #   initTimeout: 15000
  #   chatMenu: true
  #   startup: false
  #   requiresOAuth: true

  # OPTION 2: OAuth configured in Ranger (client ID, secret, scopes defined here)
  # Ranger handles the OAuth flow and passes token to MCP server via Authorization header
  # ms365-mcp:
  #   title: "Microsoft 365"
  #   iconPath: "Microsoft365Icon"
  #   type: streamable-http
  #   url: "http://localhost:3001/sharepoint-mcp/mcp"
  #   timeout: 30000
  #   initTimeout: 15000
  #   chatMenu: true
  #   startup: false
  #   requiresOAuth: true
  #   # Server instructions guide the model on when to use these tools
  #   serverInstructions: |
  #     ## Microsoft 365 Tools Usage Guide
      
  #     These tools are for accessing the user's Microsoft 365 data (Outlook, SharePoint, OneDrive, Teams).
      
  #     **CRITICAL: DO NOT ASK FOR CLARIFICATION**
  #     When a query clearly matches one tool type, execute it immediately. NEVER offer multiple approach options.
  #     - Stock prices, news, weather, public info → use web_search directly (NOT these MS365 tools)
  #     - User's emails, calendar, files, SharePoint, OneDrive → use MS365 tools directly
  #     - Just execute the appropriate tool - don't ask "which would you prefer?"
      
  #     **WHEN TO USE THESE TOOLS:**
  #     - User asks about THEIR emails, calendar, files, or documents (e.g., "check my emails", "find my document")
  #     - User references "my SharePoint", "my OneDrive", "my Outlook", "my Teams"
  #     - User asks to search within their organization's Microsoft 365 data
  #     - User wants to look up people/contacts in their organization
  #     - MRAs (Master Reference Architecture), architecture documents, technical specs
  #     - Build permits, permit documents, construction documents
  #     - Company policies, procedures, internal documentation
  #     - Any document stored in SharePoint or OneDrive
  #     - Project files, team documents, shared resources
      
  #     **WHEN NOT TO USE THESE TOOLS (use web_search instead):**
  #     - Stock prices, cryptocurrency, market data → web_search
  #     - News, current events, headlines → web_search  
  #     - Weather forecasts → web_search
  #     - Product information, reviews → web_search
  #     - Any public internet information → web_search
  #     - User asks about their uploaded files in this chat → file_search
      
  #     **IMPORTANT:** If user says "search the web", "look online", "google this" → use web_search, NOT these tools.
      
  #     **UI RESOURCES - TOKEN OPTIMIZATION:**
  #     When these tools return data with a UI resource (interactive panel), avoid repeating the full data in your text response.
  #     The UI resource already displays the information interactively (emails, calendar events, files, etc.).
      
  #     DO:
  #     - Provide a brief acknowledgment like "I found 12 emails - you can view them in the panel"
  #     - Highlight important or urgent items (e.g., "You have 2 unread emails from your manager")
  #     - Summarize if the user specifically asks for a summary or analysis
  #     - Answer specific questions about the data (e.g., "Yes, you have a meeting at 3pm")
      
  #     DON'T:
  #     - List or table every single item when the UI already shows them
  #     - Repeat full email subjects, file names, or event details that are visible in the panel
  #     - Ask which approach the user prefers when the answer is obvious
      
  #     Users can see and interact with the data directly in the UI panel.
  #   # OAuth configuration - Ranger will use these instead of auto-discovery
  #   oauth:
  #     # Microsoft Entra ID (Azure AD) OAuth endpoints
  #     authorization_url: "${MS365_AUTHORIZATION_URL}"
  #     token_url: "${MS365_TOKEN_URL}"
  #     # Client credentials from Azure App Registration
  #     client_id: "${MS365_CLIENT_ID}"
  #     client_secret: "${MS365_CLIENT_SECRET}"
  #     # Microsoft Graph scopes
  #     scope: "https://graph.microsoft.com/User.Read https://graph.microsoft.com/User.ReadBasic.All https://graph.microsoft.com/User.Read.All offline_access https://graph.microsoft.com/Mail.Read https://graph.microsoft.com/Mail.ReadWrite https://graph.microsoft.com/Files.Read.All https://graph.microsoft.com/Files.ReadWrite.All https://graph.microsoft.com/Sites.Read.All https://graph.microsoft.com/Sites.ReadWrite.All"
  #     # Callback URL - where Microsoft redirects after auth
  #     redirect_uri: "${DOMAIN_SERVER}/api/mcp/ms365-mcp/oauth/callback"
  #     # Use PKCE for security
  #     code_challenge_methods_supported:
  #       - "S256"
  #     # Token exchange method for Microsoft (default_post = form body, basic_auth_header = Basic Auth header)
  #     token_exchange_method: "default_post"


